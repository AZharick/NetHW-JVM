# Задание 1

public class JvmComprehension {

    public static void main(String[] args) {
        int i = 1;                      // 1
        Object o = new Object();        // 2
        Integer ii = 2;                 // 3
        printAll(o, i, ii);             // 4
        System.out.println("finished"); // 7
    }

    private static void printAll(Object o, int i, Integer ii) {
        Integer uselessVar = 700;                   // 5
        System.out.println(o.toString() + i + ii);  // 6
    }
}

- Сначала сработает BootStrap ClassLoader, загружающий базовые java-классы в Metaspace

## В стеке создается фрейм для метода main

### int i = 1;
-В стек помещается значение примитивной целочисленной переменной i

### Object o = new Object();
- ClassLoader загружает класс Object в Metaspace
- В куче выделяется область памяти для хранения объекта типа Object, и ссылка на эту область присваивается переменной o, хранящейся в стеке

### Integer ii = 2;
- ClassLoader загружает класс Integer в Metaspace
- В куче в пуле целых чисел сохраняется значение 2 для переменной ii

## printAll(o, i, ii);
- В стеке уровнем выше предыдущего создается фрейм для метода printAll
- Этот фрейм будет хранить ссылку на объект o, значение 1 для i и значение 2 для ii

### Integer uselessVar = 700;
- ClassLoader возвращает из кэша класс Integer
- Так как значение 700 выходит за пределы пула Integer, в куче создается новый объект типа Integer и ссылка на него сохраняется в стек, во фрейм метода printAll

### System.out.println(o.toString() + i + ii);
- ClassLoader загружает класс System в Metaspace
- В стеке уровнем выше предыдущего создается фрейм для метода println
- o.toString() разместит в пуле строк указатель на объект о (класс и HEX-хэшкод)
- метод println выведет в поток вывода этот указатель, приконкатенировав к нему значения переменных i и ii
- после вывода фрейм-println закрывается, ссылка на указатель на объект "о" пропадает, но сам указатель еще существует готов к сборке мусора

- фрейм printAll в стеке закрывается, ссылки на Object o и Integer ii из этого конкретного фрейма стерты, как и значение i

### System.out.println("finished");
- ClassLoader возвращает из кэша класс System
- В стеке уровнем выше предыдущего создается фрейм для метода println
- Значение finished помещается в пул строк (и выводится на консоль)
- после вывода фрейм-println закрывается

## Метод main завершает работу
- закрывается фрейм main
- int i вместе со своим значением уничтожается
- ссылки на Object o и Integer ii уничтожаются. Больше на эти объекты ссылок нет, но сами объекты еще существуют готовы к сборке мусора

# Задание 2

![VisualVM_screens](D:\Heap.png)

1. loaded 529 classes
   - Загружено 529 классов
   - Метапространство заполняется на ~8MB, параллельно увеличивается и его размер
   - Использование кучи увеличивается на ~21MB

2. loaded 2117 classes
   - Загружено 2117 классов
   - Метапространство заполняется на ~13.2MB, параллельно увеличивается и его размер
   - Использование кучи снижается на ~16.8MB (вероятно, срабатывает GC, удаляя неиспользуемые объекты типов Reflections или SubTypesScanner)

3. loaded 869 classes
   - Загружено 869 классов
   - Размер и использованный объём метапространства остаются неизменными (здесь причины остались неясными)
   - Использование кучи увеличивается на ~21MB

График "Classes" при загрузке классов практически в точности повторяет пропорции графика метапространства

4. created 5000000 objects
   - Метапространство заполняется на ~4,6MB, параллельно увеличивается и его размер
   - Использование кучи увеличивается на ~144,7MB 

5. created 5000000 objects
   - Метапространство незначительно увеличивается (бо́льшая часть метаданных и классов уже загружена)
   - Использование кучи увеличивается на ~254,4MB 

6. created 5000000 objects
   - Метапространство незначительно увеличивается (бо́льшая часть метаданных и классов уже загружена)
   - Использование кучи увеличивается на ~216,8MB 